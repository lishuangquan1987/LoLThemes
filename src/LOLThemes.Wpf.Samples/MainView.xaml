<Window
    x:Class="LOLThemes.Wpf.Samples.MainView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="clr-namespace:LOLThemes.Wpf.Helpers;assembly=LOLThemes.Wpf"
    xmlns:local="clr-namespace:LOLThemes.Wpf.Samples"
    xmlns:materialIcons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:LOLThemes.Wpf.Samples.ViewModels"
    Title="MainView"
    Width="1400"
    Height="800"
    Style="{DynamicResource LOLWindowStyle}"
    mc:Ignorable="d">
    <Window.Resources>
        <!--  标题栏按钮模板  -->
        <ControlTemplate x:Key="HeaderButtonTemplate" TargetType="Button">
            <Border
                x:Name="border"
                Background="Transparent"
                SnapsToDevicePixels="True">
                <ContentPresenter
                    x:Name="contentPresenter"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center" />
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="border" Property="Background" Value="{DynamicResource HoverGoldSemiBrush}" />
                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource PrimaryGoldBrush}" />
                    <Setter TargetName="border" Property="BorderThickness" Value="0.5" />
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <!--  标题栏按钮样式  -->
        <Style x:Key="HeaderButtonStyle" TargetType="Button">
            <Setter Property="Template" Value="{StaticResource HeaderButtonTemplate}" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="40" />
        </Style>
    </Window.Resources>
    <!--  自定义标题栏内容：尺寸切换按钮和主题切换按钮  -->
    <helpers:WindowHelper.CustomHeaderContent>
        <StackPanel Margin="0,0,4,0" Orientation="Horizontal">
            <!--  尺寸切换按钮（带Popup弹出菜单）  -->
            <Button
                x:Name="SizeButton"
                Command="{Binding OpenSizePopupCommand}"
                Style="{StaticResource HeaderButtonStyle}"
                ToolTip="{Binding SizeToolTip}">
                <materialIcons:MaterialIcon
                    Width="20"
                    Height="20"
                    Foreground="{DynamicResource TextPrimaryBrush}"
                    Kind="{Binding SizeIcon}" />
            </Button>

            <!--  主题切换按钮（带Popup弹出菜单）  -->
            <Button
                x:Name="ThemeButton"
                Command="{Binding OpenThemePopupCommand}"
                Style="{StaticResource HeaderButtonStyle}"
                ToolTip="{Binding ThemeToolTip}">
                <materialIcons:MaterialIcon
                    Width="20"
                    Height="20"
                    Foreground="{DynamicResource TextPrimaryBrush}"
                    Kind="{Binding ThemeIcon}" />
            </Button>
        </StackPanel>
    </helpers:WindowHelper.CustomHeaderContent>
    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  左侧导航栏  -->
        <Border
            Grid.Column="0"
            Background="{DynamicResource BackgroundPanelBrush}"
            BorderBrush="{DynamicResource BorderDarkBrush}"
            BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--  标题  -->
                <Border
                    Grid.Row="0"
                    Padding="20"
                    Background="{DynamicResource BackgroundMediumBrush}"
                    BorderBrush="{DynamicResource BorderGoldBrush}"
                    BorderThickness="0,0,0,2">
                    <StackPanel>
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="{DynamicResource FontSizeLarge}"
                            FontWeight="{StaticResource FontWeightBold}"
                            Foreground="{DynamicResource PrimaryGoldBrush}"
                            Text="LOL THEMES" />
                        <TextBlock
                            Margin="0,5,0,0"
                            HorizontalAlignment="Center"
                            FontSize="{DynamicResource FontSizeSmall}"
                            Foreground="{DynamicResource TextSecondaryBrush}"
                            Text="WPF 控件库" />
                    </StackPanel>
                </Border>

                <!--  导航菜单  -->
                <TreeView
                    Grid.Row="1"
                    Padding="5"
                    helpers:TreeViewHelper.SelectedItem="{Binding SelectedItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Background="Transparent"
                    BorderThickness="0"
                    FontFamily="{StaticResource PrimaryFont}"
                    ItemsSource="{Binding NavigationItems}">
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal">
                                <materialIcons:MaterialIcon
                                    Width="16"
                                    Height="16"
                                    Margin="4,2,10,2"
                                    VerticalAlignment="Center"
                                    Foreground="{DynamicResource PrimaryGoldBrush}"
                                    Kind="{Binding Icon}" />
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="{DynamicResource FontSizeNormal}"
                                    FontWeight="{StaticResource FontWeightMedium}"
                                    Foreground="{DynamicResource TextPrimaryBrush}"
                                    Text="{Binding Name}" />
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                    <!--  移除显式的Style引用，使用默认样式  -->
                    <TreeView.ItemContainerStyle>
                        <Style BasedOn="{StaticResource {x:Type TreeViewItem}}" TargetType="TreeViewItem">
                            <Setter Property="IsExpanded" Value="{Binding IsExpanded}" />
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            <Setter Property="VerticalContentAlignment" Value="Center" />
                            <Setter Property="Padding" Value="0,2" />
                            <Setter Property="Margin" Value="0,1" />
                        </Style>
                    </TreeView.ItemContainerStyle>

                </TreeView>
            </Grid>
        </Border>

        <!--  右侧内容区域  -->
        <Border Grid.Column="1" Background="{DynamicResource BackgroundDarkBrush}">
            <ContentControl Content="{Binding CurrentView}" />
        </Border>

        <!--  尺寸选择Popup  -->
        <Popup
            x:Name="SizePopup"
            IsOpen="{Binding IsSizePopupOpen, Mode=TwoWay}"
            Placement="Bottom"
            PlacementTarget="{Binding ElementName=SizeButton}"
            StaysOpen="False">
            <Border
                Background="{DynamicResource BackgroundMediumBrush}"
                BorderBrush="{DynamicResource BorderGoldBrush}"
                BorderThickness="1"
                CornerRadius="4">
                <StackPanel>
                    <TextBlock
                        Margin="10,10,10,5"
                        FontWeight="Bold"
                        Foreground="{DynamicResource PrimaryGoldBrush}"
                        Text="选择尺寸主题" />
                    <Separator Margin="5,0" Background="{DynamicResource BorderDarkBrush}" />
                    <ItemsControl ItemsSource="{Binding AvailableSizeThemes}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button
                                    Margin="5,2"
                                    Padding="10,8"
                                    HorizontalContentAlignment="Left"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Command="{Binding DataContext.SelectSizeCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                    CommandParameter="{Binding Name}"
                                    Style="{StaticResource {x:Type Button}}">
                                    <Button.Content>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <materialIcons:MaterialIcon
                                                Grid.Column="0"
                                                Width="16"
                                                Height="16"
                                                Margin="0,0,10,0"
                                                Foreground="{DynamicResource PrimaryGoldBrush}"
                                                Kind="{Binding Icon}" />
                                            <TextBlock
                                                Grid.Column="1"
                                                Foreground="{DynamicResource TextPrimaryBrush}"
                                                Text="{Binding Description}" />
                                            <materialIcons:MaterialIcon
                                                Grid.Column="2"
                                                Width="16"
                                                Height="16"
                                                Margin="10,0,0,0"
                                                Foreground="{DynamicResource SuccessGreenBrush}"
                                                Kind="Check">
                                                <materialIcons:MaterialIcon.Visibility>
                                                    <MultiBinding Converter="{StaticResource EnumEqualityConverter}">
                                                        <Binding Path="SizeTheme" />
                                                        <Binding Path="DataContext.CurrentSizeTheme" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                    </MultiBinding>
                                                </materialIcons:MaterialIcon.Visibility>
                                            </materialIcons:MaterialIcon>
                                        </Grid>
                                    </Button.Content>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </Popup>

        <!--  主题选择Popup  -->
        <Popup
            x:Name="ThemePopup"
            IsOpen="{Binding IsThemePopupOpen, Mode=TwoWay}"
            Placement="Bottom"
            PlacementTarget="{Binding ElementName=ThemeButton}"
            StaysOpen="False">
            <Border
                Background="{DynamicResource BackgroundMediumBrush}"
                BorderBrush="{DynamicResource BorderGoldBrush}"
                BorderThickness="1"
                CornerRadius="4">
                <StackPanel>
                    <TextBlock
                        Margin="10,10,10,5"
                        FontWeight="Bold"
                        Foreground="{DynamicResource PrimaryGoldBrush}"
                        Text="选择主题" />
                    <Separator Margin="5,0" Background="{DynamicResource BorderDarkBrush}" />
                    <ItemsControl ItemsSource="{Binding AvailableThemes}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button
                                    Margin="5,2"
                                    Padding="10,8"
                                    HorizontalContentAlignment="Left"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Command="{Binding DataContext.SelectThemeCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource {x:Type Button}}">
                                    <Button.Content>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <materialIcons:MaterialIcon
                                                Grid.Column="0"
                                                Width="16"
                                                Height="16"
                                                Margin="0,0,10,0"
                                                Foreground="{DynamicResource PrimaryGoldBrush}"
                                                Kind="{Binding Icon}" />
                                            <TextBlock
                                                Grid.Column="1"
                                                Foreground="{DynamicResource TextPrimaryBrush}"
                                                Text="{Binding Description}" />
                                            <materialIcons:MaterialIcon
                                                Grid.Column="2"
                                                Width="16"
                                                Height="16"
                                                Margin="10,0,0,0"
                                                Foreground="{DynamicResource SuccessGreenBrush}"
                                                Kind="Check">
                                                <materialIcons:MaterialIcon.Visibility>
                                                    <MultiBinding Converter="{StaticResource EnumEqualityConverter}">
                                                        <Binding Path="Theme" />
                                                        <Binding Path="DataContext.CurrentTheme" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                    </MultiBinding>
                                                </materialIcons:MaterialIcon.Visibility>
                                            </materialIcons:MaterialIcon>
                                        </Grid>
                                    </Button.Content>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</Window>
