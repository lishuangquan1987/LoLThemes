<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
    xmlns:materialIcons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
    xmlns:smtx="clr-namespace:ShowMeTheXAML;assembly=ShowMeTheXAML"
    xmlns:smtxAe="clr-namespace:ShowMeTheXAML.AvalonEdit;assembly=ShowMeTheXAML.AvalonEdit">

    <!--  合并基础资源  -->
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/LOLThemes.Wpf;component/Themes/Colors.xaml" />
        <ResourceDictionary Source="/LOLThemes.Wpf;component/Themes/Fonts.xaml" />
    </ResourceDictionary.MergedDictionaries>

    <!--  TextDocumentValueConverter 资源  -->
    <smtxAe:TextDocumentValueConverter x:Key="TextDocumentValueConverter" />

    <!--  XamlDisplay 可折叠样式 - 优化为 MaterialDesign 风格  -->
    <Style TargetType="{x:Type smtx:XamlDisplay}">
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Margin" Value="0,0,0,20" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type smtx:XamlDisplay}">
                    <StackPanel>
                        <!--  控件显示区域  -->
                        <ContentPresenter Margin="0,0,0,10" ContentSource="Content" />

                        <!--  代码显示区域 - 可折叠  -->
                        <Expander
                            x:Name="CodeExpander"
                            IsExpanded="False"
                            Style="{StaticResource LOLExpanderStyle}">
                            <Expander.Header>
                                <StackPanel Orientation="Horizontal">
                                    <materialIcons:MaterialIcon
                                        Width="16"
                                        Height="16"
                                        Margin="0,0,8,0"
                                        VerticalAlignment="Center"
                                        Foreground="{DynamicResource PrimaryGoldBrush}"
                                        Kind="CodeTags" />
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        FontSize="{StaticResource FontSizeNormal}"
                                        FontWeight="{StaticResource FontWeightMedium}"
                                        Foreground="{DynamicResource TextPrimaryBrush}"
                                        Text="查看 XAML 代码" />
                                    <TextBlock
                                        Margin="8,0,0,0"
                                        VerticalAlignment="Center"
                                        FontSize="{StaticResource FontSizeSmall}"
                                        Foreground="{DynamicResource TextSecondaryBrush}"
                                        Text="(点击展开/折叠)" />
                                </StackPanel>
                            </Expander.Header>

                            <!--  代码内容区域  -->
                            <Border
                                Margin="0,10,0,0"
                                Padding="0"
                                Background="{DynamicResource BackgroundInputBrush}"
                                BorderBrush="{DynamicResource BorderGoldBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                SnapsToDevicePixels="True"
                                UseLayoutRounding="True">

                                <!--  代码编辑器标题栏  -->
                                <DockPanel>
                                    <Border
                                        Height="36"
                                        Background="{DynamicResource BackgroundDarkBrush}"
                                        BorderBrush="{DynamicResource BorderGoldBrush}"
                                        BorderThickness="0,0,0,1"
                                        DockPanel.Dock="Top"
                                        UseLayoutRounding="True">
                                        <StackPanel Margin="10,0,10,0" Orientation="Horizontal">
                                            <materialIcons:MaterialIcon
                                                Width="16"
                                                Height="16"
                                                Margin="0,0,8,0"
                                                VerticalAlignment="Center"
                                                Foreground="{DynamicResource PrimaryGoldBrush}"
                                                Kind="Code" />
                                            <TextBlock
                                                VerticalAlignment="Center"
                                                FontSize="{StaticResource FontSizeSmall}"
                                                FontWeight="{StaticResource FontWeightMedium}"
                                                Foreground="{DynamicResource TextPrimaryBrush}"
                                                Text="XAML 代码" />
                                            <TextBlock
                                                Margin="8,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="{StaticResource FontSizeSmall}"
                                                Foreground="{DynamicResource TextSecondaryBrush}"
                                                Text="(可复制)" />
                                            <Button
                                                Margin="0,0,0,0"
                                                Padding="8,4"
                                                HorizontalAlignment="Right"
                                                Command="Copy"
                                                CommandParameter="{Binding Xaml, RelativeSource={RelativeSource TemplatedParent}}"
                                                Content="复制"
                                                DockPanel.Dock="Right"
                                                Style="{StaticResource LOLSecondaryButtonStyle}"
                                                ToolTip="复制代码到剪贴板">
                                                <Button.ContentTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <materialIcons:MaterialIcon
                                                                Width="14"
                                                                Height="14"
                                                                Margin="0,0,5,0"
                                                                Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                                                Kind="ContentCopy" />
                                                            <TextBlock Text="{Binding}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Button.ContentTemplate>
                                            </Button>
                                        </StackPanel>
                                    </Border>

                                    <!--  XAML 代码编辑器  -->
                                    <avalonEdit:TextEditor
                                        MaxHeight="400"
                                        Padding="10"
                                        Background="{DynamicResource BackgroundInputBrush}"
                                        Document="{Binding Xaml, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource TextDocumentValueConverter}}"
                                        FontFamily="Consolas, 'Courier New', monospace"
                                        FontSize="13"
                                        Foreground="{DynamicResource TextPrimaryBrush}"
                                        HorizontalScrollBarVisibility="Auto"
                                        IsReadOnly="True"
                                        LineNumbersForeground="{DynamicResource TextSecondaryBrush}"
                                        ShowLineNumbers="True"
                                        SnapsToDevicePixels="True"
                                        TextOptions.TextFormattingMode="Display"
                                        TextOptions.TextRenderingMode="ClearType"
                                        VerticalScrollBarVisibility="Auto" />
                                </DockPanel>
                            </Border>
                        </Expander>
                    </StackPanel>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
