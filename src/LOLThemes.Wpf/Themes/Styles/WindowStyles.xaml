<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:helpers="clr-namespace:LOLThemes.Wpf.Helpers;assembly=LOLThemes.Wpf">
    
    <!-- 合并基础资源，确保 WindowStyles 可以访问 Colors 和 Fonts -->
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/LOLThemes.Wpf;component/Themes/Colors.xaml"/>
        <ResourceDictionary Source="/LOLThemes.Wpf;component/Themes/Fonts.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <!-- LOL Window Style -->
    <Style x:Key="LOLWindowStyle" TargetType="{x:Type Window}">
        <Setter Property="WindowStyle" Value="None"/>
        <Setter Property="AllowsTransparency" Value="True"/>
        <Setter Property="Background" Value="{DynamicResource BackgroundDarkBrush}"/>
        <Setter Property="BorderThickness" Value="0.5"/>
        <Setter Property="FontFamily" Value="{StaticResource PrimaryFont}"/>
        <Setter Property="FontSize" Value="{DynamicResource FontSizeNormal}"/>
        <Setter Property="ResizeMode" Value="CanResizeWithGrip"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Window}">
                    <Border Background="{DynamicResource BackgroundDarkBrush}"
                            BorderBrush="{DynamicResource BorderGoldBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">
                        <Border.Effect>
                            <DropShadowEffect x:Name="windowShadow" 
                                            BlurRadius="15" 
                                            ShadowDepth="0" 
                                            Opacity="0.3"
                                            Color="#C8AA6E"/>
                        </Border.Effect>
                        
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Title Bar -->
                            <Border Grid.Row="0" 
                                    x:Name="TitleBar"
                                    Background="{DynamicResource BackgroundMediumBrush}"
                                    BorderBrush="{DynamicResource BorderDarkBrush}"
                                    BorderThickness="0,0,0,1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Window Icon -->
                                    <Image Grid.Column="0" 
                                           Source="{TemplateBinding Icon}"
                                           Width="24" 
                                           Height="24" 
                                           Margin="10,0,0,0"
                                           VerticalAlignment="Center"/>

                                    <!-- Window Title -->
                                    <TextBlock Grid.Column="1" 
                                               Text="{TemplateBinding Title}"
                                               FontSize="{DynamicResource FontSizeMedium}"
                                               FontWeight="{StaticResource FontWeightMedium}"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center"
                                               Margin="10,0,0,0"/>

                                    <!-- Window Buttons -->
                                    <StackPanel Grid.Column="2" 
                                                Orientation="Horizontal">
                                        
                                        <!-- Custom Header Content -->
                                        <ContentPresenter x:Name="CustomHeaderContentContainer"
                                                        Content="{Binding Path=(helpers:WindowHelper.CustomHeaderContent), RelativeSource={RelativeSource TemplatedParent}}"
                                                        Margin="0,0,4,0"
                                                        VerticalAlignment="Center"/>
                                        
                                        <!-- Minimize Button -->
                                        <Button x:Name="MinimizeButton"
                                                Width="40" 
                                                Height="40">
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="Transparent" 
                                                            x:Name="border"
                                                            SnapsToDevicePixels="True">
                                                        <Path x:Name="minimizePath"
                                                              Data="M0,0 L10,0" 
                                                              Stroke="{DynamicResource TextPrimaryBrush}"
                                                              StrokeThickness="1.5"
                                                              HorizontalAlignment="Center"
                                                              VerticalAlignment="Center"
                                                              StrokeEndLineCap="Round"
                                                              StrokeStartLineCap="Round"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="{DynamicResource BackgroundMediumSemiBrush}"/>
                                                            <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource PrimaryGoldBrush}"/>
                                                            <Setter TargetName="border" Property="BorderThickness" Value="0.5"/>
                                                            <Setter TargetName="minimizePath" Property="Stroke" Value="{DynamicResource TextBrightBrush}"/>
                                                            <Setter TargetName="minimizePath" Property="StrokeThickness" Value="2"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>

                                        <!-- Maximize/Restore Button -->
                                        <Button x:Name="MaximizeButton"
                                                Width="40" 
                                                Height="40">
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="Transparent" 
                                                            x:Name="border"
                                                            SnapsToDevicePixels="True">
                                                        <Path x:Name="MaximizePath"
                                                              Data="M0,0 L10,0 L10,10 L0,10 Z" 
                                                              Stroke="{DynamicResource TextPrimaryBrush}"
                                                              StrokeThickness="1.5"
                                                              HorizontalAlignment="Center"
                                                              VerticalAlignment="Center"
                                                              StrokeEndLineCap="Round"
                                                              StrokeStartLineCap="Round"
                                                              Fill="Transparent"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="{DynamicResource BackgroundMediumSemiBrush}"/>
                                                            <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource PrimaryGoldBrush}"/>
                                                            <Setter TargetName="border" Property="BorderThickness" Value="0.5"/>
                                                            <Setter TargetName="MaximizePath" Property="Stroke" Value="{DynamicResource TextBrightBrush}"/>
                                                            <Setter TargetName="MaximizePath" Property="StrokeThickness" Value="2"/>
                                                        </Trigger>
                                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                            <Setter TargetName="MaximizePath" Property="Data" Value="M2,2 L8,2 L8,8 L2,8 Z M0,0 L10,0 L10,10"/>
                                                        </DataTrigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>

                                        <!-- Close Button -->
                                        <Button x:Name="CloseButton"
                                                Width="40" 
                                                Height="40">
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="Transparent" 
                                                            x:Name="border"
                                                            SnapsToDevicePixels="True">
                                                        <Path x:Name="closePath"
                                                              Data="M0,0 L10,10 M10,0 L0,10" 
                                                              Stroke="{DynamicResource TextPrimaryBrush}"
                                                              StrokeThickness="1.5"
                                                              HorizontalAlignment="Center"
                                                              VerticalAlignment="Center"
                                                              StrokeEndLineCap="Round"
                                                              StrokeStartLineCap="Round"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="{DynamicResource ErrorRedBrush}"/>
                                                            <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource ErrorRedBrush}"/>
                                                            <Setter TargetName="border" Property="BorderThickness" Value="0.5"/>
                                                            <Setter TargetName="closePath" Property="Stroke" Value="{DynamicResource TextWhiteBrush}"/>
                                                            <Setter TargetName="closePath" Property="StrokeThickness" Value="2"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Content Area -->
                            <AdornerDecorator Grid.Row="1">
                                <ContentPresenter/>
                            </AdornerDecorator>

                            <!-- Resize Grip -->
                            <ResizeGrip Grid.Row="1"
                                       HorizontalAlignment="Right"
                                       VerticalAlignment="Bottom"
                                       Visibility="Collapsed"/>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ResizeMode to Visibility Converter -->
    <Style x:Key="LOLWindowStyleSimple" TargetType="{x:Type Window}" BasedOn="{StaticResource LOLWindowStyle}">
        <Setter Property="ResizeMode" Value="NoResize"/>
    </Style>

    <!-- 默认 Window 样式 -->
    <Style TargetType="{x:Type Window}" BasedOn="{StaticResource LOLWindowStyle}"/>

</ResourceDictionary>
